## المباريات (Match)

### مسارات

-   GET `api/Match` — جلب مباريات الدوري الحالي (حسب نظامه)
-   GET `api/Match/matches/all` — جلب كل الدوريات مع المباريات (حسب النظام الحالي)
-   GET `api/Match/{id}` — جلب مباراة بالتفاصيل (VM)
-   POST `api/Match/{matchId}/result` (Admin) — تحديث نتيجة مباراة (Body: MatchResultDto)
-   DELETE `api/Match/reset/{matchId}` (Admin) — إعادة ضبط نتيجة مباراة

### الاختيار حسب النظام

-   اختيار الخدمة يتم عبر `IMatchServiceSelector` حسب `SystemOfLeague`:
    -   Points → `PointMatchService`
    -   Classic → `ClassicMatchService`

### أنظمة النتائج بالتفصيل

-   SystemOfLeague = Points

    -   مرحلة الدوري/المجموعات:
        -   المباراة تتكون من جولات (Rounds)؛ العدد الافتراضي الموصى به 5 ويمكن تغييره ديناميكياً من خلال API.
        -   فوز الجولة: +1 للمُستحق. تعادل الجولة: +0.5 لكل لاعب.
        -   تكتمل المباراة عند الوصول للحد الأقصى للجولات.
        -   يتم تحديث إحصاءات اللاعبين وترتيبهم بعد كل تحديث.
    -   الإقصائيات (Quarter/Semi/Final):
        -   لا تعادل. يجب تمرير `winnerId` صحيح.
        -   تعيين `WinnerId`، والنتيجة تكون 1 مقابل 0 للفائز فقط للدلالة.
        -   لا تُضاف نقاط ترتيب في الإقصائيات.

-   SystemOfLeague = Classic
    -   مرحلة الدوري/المجموعات:
        -   مباراة واحدة بقرار نهائي: فوز = 3 نقاط للفائز، تعادل = 1 نقطة لكل لاعب.
        -   تسجَّل النتائج كالتالي: فوز (3/0 أو 0/3)، تعادل (1/1).
        -   يتم تحديث الإحصاءات والترتيب فورًا.
    -   الإقصائيات:
        -   لا تعادل؛ يجب `winnerId`.
        -   تُسجل المباراة كـ 3/0 أو 0/3 ويُحدد `WinnerId`، وتعتبر مكتملة.

### إدارة إعداد الجولات (Admin)

-   GET `api/GameRules/max-rounds` — قراءة القيمة الحالية
-   POST `api/GameRules/max-rounds` (Admin) — تعديل القيمة
    -   Body: `{ maxRoundsPerMatch: number (>0) }`

### التحقق والقيود

-   Points:
    -   لا تتجاوز الحد الحالي للجولات (قابل للتعديل من الـ API).
    -   التعادل مسموح فقط خارج الإقصائيات.
-   Classic:
    -   في المجموعات: فوز أو تعادل بالقيم المحددة فقط.
    -   في الإقصائيات: لا تعادل؛ يجب `winnerId`.
-   عام:
    -   `winnerId` يجب أن يكون أحد طرفي المباراة، وإلا تُعاد رسالة خطأ.
    -   إعادة الضبط (Reset) ممنوعة إذا بدأت مرحلة أحدث (مثال: لا Reset من GroupStage بعد بدء QuarterFinals، وهكذا).
