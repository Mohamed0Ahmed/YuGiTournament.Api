## الدوري (League)

### مسارات (تحتاج Admin إلا إذا ذُكر خلاف ذلك)

-   POST `api/League/start` — بدء دوري جديد (Body: StartLeagueDto)
    -   عند `SystemOfLeague = Points` يجب تمرير `roundsPerMatch > 0` (إجباري) ليتم اعتمادها كقيمة الجولات للمباريات.
-   POST `api/League/reset/{leagueId}` — إنهاء الدوري ووضع `IsFinished=true`
-   DELETE `api/League/delete/{leagueId}` — حذف دوري (Soft/Delete عبر الخدمة)
-   GET `api/League/getCurrentLeague` — جلب الدوري الحالي (Public)
-   POST `api/League/{leagueId}/create-groups` — إنشاء مجموعات ومبارياتها تلقائيًا
-   POST `api/League/{leagueId}/start-knockouts` — بدء ربع النهائي
-   POST `api/League/{leagueId}/start-semifinals` — بدء نصف النهائي
-   POST `api/League/{leagueId}/start-final` — بدء النهائي

### Single Flow (بدون مجموعات)

-   جدولة Round-Robin: كل لاعب يواجه كل لاعب مرة واحدة.
-   آلية احتساب النتائج تعتمد على SystemOfLeague:
    -   Points: المباراة عبارة عن جولات؛ عدد الجولات يؤخذ من `roundsPerMatch` عند بدء الدوري (إجباري). فوز الجولة = +1، تعادل الجولة = +0.5 لكل لاعب.
    -   Classic: مباراة واحدة؛ فوز = +3 نقاط للفائز، تعادل = +1 نقطة لكل لاعب.
-   لا وجود لإقصائيات في Single بشكل افتراضي إلا إذا تمت إضافتها يدويًا.

### Groups Flow

-   متطلبات الإنشاء: عدد اللاعبين 16 أو 20 فقط.
-   التوزيع: عشوائي على 4 مجموعات (4×4 أو 4×5).
-   مباريات المجموعات: كل لاعب ضد كل لاعب في مجموعته.
-   لا بدء للإقصائيات قبل اكتمال جميع مباريات المجموعات.
-   التأهل لربع النهائي:
    -   المباراة 1: 1 المجموعة1 × 2 المجموعة2
    -   المباراة 2: 1 المجموعة2 × 2 المجموعة1
    -   المباراة 3: 1 المجموعة3 × 2 المجموعة4
    -   المباراة 4: 1 المجموعة4 × 2 المجموعة3
-   نصف النهائي: فائز (1 و3) على جانب، فائز (2 و4) على جانب آخر. يُعاد الخلط إن تواجد لاعبان من نفس المجموعة في نفس الجانب.
-   النهائي: الفائزان من نصف النهائي.

### كسر التعادل والترتيب

-   الترتيب: بالنقاط نزولياً.
-   كسر التعادل: المواجهات المباشرة أولاً ثم WinRate.
-   في المجموعات: يُحسب لكل مجموعة على حدة بنفس القواعد.

### قيود إعادة الضبط

-   لا يُسمح بإعادة ضبط مباراة من مرحلة أقدم إذا بدأت مرحلة أحدث (GroupStage → QuarterFinals → SemiFinals → Final).
